syntax = "proto3";

package canton;

import "canton/canton_value.proto";
import "canton/canton_txn_nodes.proto";

message PreparedTransaction {
  DamlTransaction transaction = 1;
  Metadata metadata = 2;
}

message Metadata {
  message SubmitterInfo {
    repeated string act_as = 1;
    string command_id = 2;
  }

  message GlobalKeyMappingEntry {
    GlobalKey key = 1;
    optional Value value = 2;
  }

  message InputContract {
    oneof contract {
      Create v1 = 1;
    }
    uint64 created_at = 1000;
    reserved 1001;
    bytes event_blob = 1002;
  }

  reserved 1;

  SubmitterInfo submitter_info = 2;
  string synchronizer_id = 3;
  uint32 mediator_group = 4;
  string transaction_uuid = 5;
  uint64 preparation_time = 6;
  repeated InputContract input_contracts = 7;

  optional uint64 min_ledger_effective_time = 9;
  optional uint64 max_ledger_effective_time = 10;

  repeated GlobalKeyMappingEntry global_key_mapping = 8;
}

message DamlTransaction {
  message DNode {
    string node_id = 1;

    oneof versioned_node {
      Node v1 = 1000;
    }
  }

  message NodeSeed {
    int32 node_id = 1;
    bytes seed = 2;
  }

  string version = 1;
  repeated string roots = 2;
  repeated DNode nodes = 3;
  repeated NodeSeed node_seeds = 4;
}

message GlobalKey {
  Identifier template_id = 1;
  string package_name = 2;
  Value key = 3;
  bytes hash = 4;
}
